<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>매화역수 + 글자 조합 하이라이트</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input[type="number"], select {
      padding: 5px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 0;
    }
    table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
      vertical-align: middle;
    }
    th {
      background: #007BFF;
      color: white;
    }
    .highlight-blue {
      background-color: lightblue !important;
    }
    .highlight-red {
      background-color: lightcoral !important;
    }
    .mapping {
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.1em;
    }
    .output {
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f5f5f5;
      min-height: 50px;
      white-space: pre-wrap;
      font-size: 1.1em;
      line-height: 1.4em;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>매화역수 계산기 + 글자 조합 하이라이트</h1>
  
  <!-- 매화역수 계산 영역 -->
  <label for="birthMonth">음력 생월 (1~12):</label>
  <input type="number" id="birthMonth" min="1" max="12" value="2">
  
  <label for="birthDay">음력 생일 (1~31):</label>
  <input type="number" id="birthDay" min="1" max="31" value="9">
  
  <label for="age">올해 나이:</label>
  <input type="number" id="age" min="1" value="28">
  
  <button onclick="calculateSuri()">계산하기</button>
  
  <div id="result"></div>
  
  <!-- 1~12월 한자 매핑 안내 -->
  <div class="mapping">
    <div>1월: 寅(인) | 2월: 卯(묘) | 3월: 辰(진) | 4월: 巳(사) | 5월: 午(오) | 6월: 未(미)</div>
    <div>7월: 申(신) | 8월: 酉(유) | 9월: 戌(술) | 10월: 亥(해) | 11월: 子(자) | 12월: 丑(축)</div>
    <div><strong>전체: 인, 묘, 진, 사, 오, 미, 신, 유, 술, 해, 자, 축</strong></div>
  </div>
  
  <hr>

  <!-- 글자 선택 영역 (암합/육합/… 조합 반영) -->
  <h2>글자 선택 → 관련 조합 하이라이트</h2>
  <label for="zodiacSelect">글자 선택:</label>
  <select id="zodiacSelect">
    <option value="인">인</option>
    <option value="묘">묘</option>
    <option value="진">진</option>
    <option value="사">사</option>
    <option value="오">오</option>
    <option value="미">미</option>
    <option value="신">신</option>
    <option value="유">유</option>
    <option value="술">술</option>
    <option value="해">해</option>
    <option value="자">자</option>
    <option value="축">축</option>
  </select>
  <button onclick="highlightCombos()">하이라이트 적용</button>
  
  <div id="logOutput" class="output"></div>
</div>

<script>
/* ---------------------------
   1) 매화역수 계산
--------------------------- */
let globalMonthCells = []; // 12개월 셀 id
const monthLetters = ["인","묘","진","사","오","미","신","유","술","해","자","축"];

// n이 10 이상이면 9를 계속 빼서 1~9로 맞춤
function adjust(n) {
  while (n > 9) {
    n -= 9;
  }
  return n;
}

// 올해 나이 각 자리 합
function digitSum(num) {
  return num.toString().split('').reduce((acc, cur) => acc + parseInt(cur), 0);
}

function calculateSuri() {
  const birthMonth = parseInt(document.getElementById("birthMonth").value);
  const birthDay = parseInt(document.getElementById("birthDay").value);
  const age = parseInt(document.getElementById("age").value);
  
  // 1월 = (생월 + 생일 + 1 - 9)
  const m1 = adjust(birthMonth + birthDay + 1 - 9);
  // 2월 = (올해 나이의 각 자리 합 + 1월 값)
  const m2 = adjust(digitSum(age) + m1);
  // 3월 = 1월 + 2월
  const m3 = adjust(m1 + m2);
  // 4월 = 1월 + 3월
  const m4 = adjust(m1 + m3);
  // 5월 = 2월 + 3월
  const m5 = adjust(m2 + m3);
  // 6월 = 4월 + 5월
  const m6 = adjust(m4 + m5);
  // 7월 = 4월 + 6월
  const m7 = adjust(m4 + m6);
  // 8월 = 5월 + 6월
  const m8 = adjust(m5 + m6);
  // 9월 = 7월 + 8월
  const m9 = adjust(m7 + m8);
  // 10월 = 1월 + 4월 + 7월
  const m10 = adjust(m1 + m4 + m7);
  // 11월 = 2월 + 5월 + 8월
  const m11 = adjust(m2 + m5 + m8);
  // 12월 = 10월 + 11월
  const m12 = adjust(m10 + m11);
  
  const monthlySuri = [m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12];
  const monthNames = [
    "1월 寅 (인)","2월 卯 (묘)","3월 辰 (진)",
    "4월 巳 (사)","5월 午 (오)","6월 未 (미)",
    "7월 申 (신)","8월 酉 (유)","9월 戌 (술)",
    "10월 亥 (해)","11월 子 (자)","12월 丑 (축)"
  ];
  
  let resultHTML = '<h2>계산 결과 (3개월씩)</h2>';
  resultHTML += '<table>';
  // 테이블 행 구성 (3열씩)
  for (let i=0; i<12; i+=3) {
    resultHTML += '<tr>';
    for (let j=i; j<i+3; j++) {
      resultHTML += `
        <td id="monthCell-${j}">
          <strong>${monthNames[j]}</strong><br>
          ${monthlySuri[j]}
        </td>`;
    }
    resultHTML += '</tr>';
  }
  resultHTML += '</table>';
  
  document.getElementById("result").innerHTML = resultHTML;
  
  // 매번 계산할 때마다, 12개 셀 id를 기억해둠
  globalMonthCells = [];
  for (let i=0; i<12; i++) {
    globalMonthCells.push(`monthCell-${i}`);
  }
  document.getElementById("logOutput").innerText = "결과표가 생성되었습니다. 아래 글자 선택을 해보세요!";
}

/* ---------------------------
   2) 글자 조합 (암합~귀문) 데이터
   - 열별로 파란색 / 빨간색 구분
--------------------------- */
const colColor = {
  "암합":"blue","육합":"blue","꼭지합":"blue","삼합":"blue","방합":"blue",
  "형살":"red","상충":"red","귀문":"red"
};

// 2차원 구조: {열이름: [조합 문자열들]}
const combosTable = {
  "암합":  ["자사","오해","인해"],
  "육합":  ["자축","인해","묘술","진묘","사신","오미"],
  "꼭지합":["진사","축인","술해","신미"],
  "삼합":  ["인오술","신자진","해묘미","사유축","인오술","인오술(중복?)"],
  "방합":  ["인묘진","사오미","신유술","해자축"],
  "형살":  ["인사신","축술미","자묘","진진","오오","유유","해해"],
  "상충":  ["자오","묘유","사해","인신","진술"],
  "귀문":  ["자유","축오","인미","묘신","진해","사술"]
};

// 어떤 콤보는 2글자, 어떤 건 3글자, 4글자… → 분해용 함수
function splitCombo(str) {
  // 예: "사오미" → ["사","오","미"]
  //     "인오술" → ["인","오","술"]
  // 공백 없이 연속 2~3자일 뿐이므로, 각 글자 한 번에 한 자씩
  return str.split("");
}

/* ---------------------------
   3) 글자 선택 시 → 해당 글자 포함된 조합 찾아,
      그 조합에 등장하는 모든 글자를 하이라이트
--------------------------- */
function highlightCombos() {
  // 우선 기존 하이라이트 제거
  for (let i=0; i<12; i++){
    const cellId = `monthCell-${i}`;
    const cell = document.getElementById(cellId);
    if (cell) {
      cell.classList.remove("highlight-blue","highlight-red");
    }
  }
  
  // 선택한 글자 (ex: "사")
  const selected = document.getElementById("zodiacSelect").value;
  let logMsg = `선택 글자 [${selected}] 관련 하이라이트:\n`;
  
  // combosTable의 모든 열을 순회
  for (const colName in combosTable) {
    // 열에 속한 모든 콤보를 순회
    const comboArr = combosTable[colName];
    comboArr.forEach(comboStr => {
      // comboStr 예: "사해", "사오미", "인사신" 등
      const letters = splitCombo(comboStr); // ["사","해"] or ["사","오","미"]
      // 만약 그 콤보에 selected가 포함되어 있으면 → 그 콤보의 모든 글자를 하이라이트
      if (letters.includes(selected)) {
        // 파란색/빨간색 구분
        const highlightClass = (colColor[colName] === "blue") ? "highlight-blue" : "highlight-red";
        
        // 해당 콤보에 등장하는 글자들을 모두 하이라이트
        letters.forEach(letter => {
          // letter를 12지(인,묘,진,사,오,미,신,유,술,해,자,축) 중 몇 번째인지 찾기
          const idx = monthLetters.indexOf(letter);
          if (idx >= 0) {
            const cell = document.getElementById(`monthCell-${idx}`);
            if (cell) {
              cell.classList.add(highlightClass);
            }
          }
        });
        
        logMsg += `- [${colName}] "${comboStr}" → ${letters.join(",")} (→ ${highlightClass})\n`;
      }
    });
  }
  
  document.getElementById("logOutput").innerText = logMsg.trim();
}
</script>
</body>
</html>
